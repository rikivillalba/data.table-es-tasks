source("~/trad.R", echo=TRUE)
dt <- data.table(x = 0)
library(data.table)
dt <- data.table(x = 0)
dt$x = list(list(dt))
dt
?:=
?":="
R"a"
R("a")
R"(a)"
R"(a\b)"
# x las dudas
temps_hist <- if(!length(files.last)) NULL else fread(
file = file.path(path.climate, files.last),
select  = c("DATE","TMP")) |>
_[.(DATE = seq.POSIXt(range(DATE)[1], range(DATE)[2], by="hour")),
.(TMP = mean(TMP, na.rm = T)), on = "DATE",  by = .EACHI] |>
setnafill("locf", cols="TMP")
# https://www.ncei.noaa.gov/access/search/data-search/global-hourly?bbox=-34.580,-59.128,-35.536,-57.603
# https://www.ncei.noaa.gov/access/search/data-search/global-hourly?bbox=-34.580,-59.128,-35.536,-57.603
# NOTA SI NO SE QUIERE ACTUALIZAR TEMPERATURAS, CONTINUAR
# DESDE LA SECCIÓN "empezar acá"
library(data.table)
library(ggplot2)
# https://www.ncei.noaa.gov/access/search/data-search/global-hourly?bbox=-34.580,-59.128,-35.536,-57.603
# https://www.ncei.noaa.gov/access/search/data-search/global-hourly?bbox=-34.580,-59.128,-35.536,-57.603
# NOTA SI NO SE QUIERE ACTUALIZAR TEMPERATURAS, CONTINUAR
# DESDE LA SECCIÓN "empezar acá"
library(data.table)
library(ggplot2)
path <- "C:\\Users\\ar30592993\\OneDrive - Enel Spa\\cammesa"
path.climate <- file.path(path, "climate")
#ncei_file <- "2024_87582099999.csv"
# buscar histórico vigente
files <- local({
re <- "temp ([T0-9-]{13}) a ([T0-9-]{13})\\.csv\\.gz"
file <- dir(path.climate, pattern = re)
desde <- as.POSIXct(gsub(re, "\\1", file), format = "%Y-%m-%dT%H")
hasta <- as.POSIXct(gsub(re, "\\2", file), format = "%Y-%m-%dT%H")
data.frame(file, desde, hasta)})
files.last <- files[which.max(files[["hasta"]]), "file"]
# x las dudas
temps_hist <- if(!length(files.last)) NULL else fread(
file = file.path(path.climate, files.last),
select  = c("DATE","TMP")) |>
_[.(DATE = seq.POSIXt(range(DATE)[1], range(DATE)[2], by="hour")),
.(TMP = mean(TMP, na.rm = T)), on = "DATE",  by = .EACHI] |>
setnafill("locf", cols="TMP")
temps_all <- temps_hist
if (!"suncalc" %in% installed.packages()) {
install.packages("suncalc")
}
# gráfico
{
days_ahead <- 40L
n_yrs <- 1L
tz <- "America/Buenos_Aires"
# Ojo al convertir fechas desde oct-2008 hasta mar-2009 (cambio de horario
# https://www.ambito.com/informacion-general/la-argentina-dos-horarios-distintos-n3522573
temp3 <- temps_all[
, .(T.max = max(TMP), T.min = min(TMP), T.med = mean(TMP),
H.max = DATE[which.max(TMP)], H.min = DATE[which.min(TMP)]),
keyby = .(FECHA = as.IDate(DATE, "%Y-%m-%d", tz=tz))]
#    by = .(FECHA = as.IDate(strftime(DATE, "%Y-%m-%d", tz=tz), tz=tz))]
#  temp3[, yday := yday(FECHA)]
temp3[, LTM_yday := floor(-(.N:1 + days_ahead) %% (365.25 * n_yrs) + 1)]
temp3[, LTM_year := floor(-(.N:1 + days_ahead) %/% (365.25 * n_yrs) + 1)]
temp3[, LTM_fecha := (as.Date(FECHA[.N]) + days_ahead
- floor(365.25 * n_yrs - 1):1)[LTM_yday]]
temp3_range <- temp3[
LTM_year < 0,
.(T.med.inf = mean(T.med) - 1.96 * sd(T.med),
T.med.sup = mean(T.med) + 1.96 * sd(T.med),
T.med.med = mean(T.med)),
by = LTM_fecha]
light_time <- suncalc::getSunlightTimes(
temp3_range$LTM_fecha, lat = ncei_loc["lat"], lon = ncei_loc["lon"],
keep = c("sunrise", "sunset")) |> as.data.table() |>
_[,.(date, horas_luz = difftime(sunset, sunrise, units = "h") )]
plt <- (
ggplot(temp3, aes(
x = LTM_fecha, y = T.med,
color = ifelse(LTM_year == 0, "Año actual", "Histórico")))
+ geom_line(aes(group = LTM_year))
+ geom_ribbon(
data = temp3_range,
aes(x = LTM_fecha, ymin = T.med.inf, ymax = T.med.sup),
inherit.aes = F, fill= "pink", alpha = 0.4) +
labs(title = paste(
"Temperatura media diaria histórica, GBA, último dato",
strftime(temps_all[.N, DATE], tz=tz)))
+ geom_line(data = temp3[LTM_year == 0])
#    + geom_area(
#      data = light_time, aes(date, horas_luz), inherit.aes = F, alpha = 0.1)
+ scale_color_manual(
values = c("Año actual" = "black", "Histórico"="lightgray"),
guide = guide_legend(title = ""))
+ scale_x_date(date_breaks = "2 week", date_labels = "%d-%b %y")
+ theme(
axis.text.x = element_text(angle = 90, size = 12, vjust = 0.5),
axis.text.y = element_text(size = 12),
axis.title.y = element_text(size = 14),
axis.title.x = element_blank(),
axis.line = element_line(),
panel.background = element_blank())
# + coord_cartesian(xlim =as.Date(c("2024-07-01", "2024-07-12")))
)
plt
}
ncei_loc = c(lat=-34.822222,lon=-58.535833)
if (!"suncalc" %in% installed.packages()) {
install.packages("suncalc")
}
# gráfico
{
days_ahead <- 40L
n_yrs <- 1L
tz <- "America/Buenos_Aires"
# Ojo al convertir fechas desde oct-2008 hasta mar-2009 (cambio de horario
# https://www.ambito.com/informacion-general/la-argentina-dos-horarios-distintos-n3522573
temp3 <- temps_all[
, .(T.max = max(TMP), T.min = min(TMP), T.med = mean(TMP),
H.max = DATE[which.max(TMP)], H.min = DATE[which.min(TMP)]),
keyby = .(FECHA = as.IDate(DATE, "%Y-%m-%d", tz=tz))]
#    by = .(FECHA = as.IDate(strftime(DATE, "%Y-%m-%d", tz=tz), tz=tz))]
#  temp3[, yday := yday(FECHA)]
temp3[, LTM_yday := floor(-(.N:1 + days_ahead) %% (365.25 * n_yrs) + 1)]
temp3[, LTM_year := floor(-(.N:1 + days_ahead) %/% (365.25 * n_yrs) + 1)]
temp3[, LTM_fecha := (as.Date(FECHA[.N]) + days_ahead
- floor(365.25 * n_yrs - 1):1)[LTM_yday]]
temp3_range <- temp3[
LTM_year < 0,
.(T.med.inf = mean(T.med) - 1.96 * sd(T.med),
T.med.sup = mean(T.med) + 1.96 * sd(T.med),
T.med.med = mean(T.med)),
by = LTM_fecha]
light_time <- suncalc::getSunlightTimes(
temp3_range$LTM_fecha, lat = ncei_loc["lat"], lon = ncei_loc["lon"],
keep = c("sunrise", "sunset")) |> as.data.table() |>
_[,.(date, horas_luz = difftime(sunset, sunrise, units = "h") )]
plt <- (
ggplot(temp3, aes(
x = LTM_fecha, y = T.med,
color = ifelse(LTM_year == 0, "Año actual", "Histórico")))
+ geom_line(aes(group = LTM_year))
+ geom_ribbon(
data = temp3_range,
aes(x = LTM_fecha, ymin = T.med.inf, ymax = T.med.sup),
inherit.aes = F, fill= "pink", alpha = 0.4) +
labs(title = paste(
"Temperatura media diaria histórica, GBA, último dato",
strftime(temps_all[.N, DATE], tz=tz)))
+ geom_line(data = temp3[LTM_year == 0])
#    + geom_area(
#      data = light_time, aes(date, horas_luz), inherit.aes = F, alpha = 0.1)
+ scale_color_manual(
values = c("Año actual" = "black", "Histórico"="lightgray"),
guide = guide_legend(title = ""))
+ scale_x_date(date_breaks = "2 week", date_labels = "%d-%b %y")
+ theme(
axis.text.x = element_text(angle = 90, size = 12, vjust = 0.5),
axis.text.y = element_text(size = 12),
axis.title.y = element_text(size = 14),
axis.title.x = element_blank(),
axis.line = element_line(),
panel.background = element_blank())
# + coord_cartesian(xlim =as.Date(c("2024-07-01", "2024-07-12")))
)
plt
}
ggsave(
filename = file.path(
path.climate,
paste0("temp_comparada-", paste0(range(temp3$FECHA), collapse = "_") ,".svg")),
plot = plt, device = "svg", width = 12, height = 7)
plt
library(plm)
View(temp3)
View(temp3)
temp3[, LTM_yday_last := floor(-(.N:1) %% (365.25 * n_yrs) + 1)]
temp3[, LTM_year_last := floor(-(.N:1) %/% (365.25 * n_yrs) + 1)]
plm(T.max ~ LTM_yday_last, data=temp3, index = "LTM_year_last")
lm(T.max ~ LTM_yday_last, data=temp3)
plm(T.max ~ -LTM_yday_last, data=temp3, index = "LTM_year_last")
View(temp3)
plm(T.max ~ LTM_year_last), data=temp3, index = "LTM_yday_last")
plm(T.max ~ LTM_year_last, data=temp3, index = "LTM_yday_last")
plm(T.max ~ LTM_year_last, data=temp3, index = "LTM_yday_last")
lm(T.max ~ LTM_year_last, data=temp3)
plt
svglite::create_svgz(file = file.path(
path.climate,
paste0("temp_comparada-", paste0(range(temp3$FECHA), collapse = "_") ,".svg")))
plm(T.max ~ LTM_year_last, data=temp3, index = "LTM_yday_last")
summary(temp3)
summary(temp3)
capture.output(summary(temp3))
capture.output(summary(temp3)) |> clipr::write_clip()
capture.output(summary(temp3)) |> strwrap() |>  clipr::write_clip()
capture.output(summary(temp3)) |> strwrap(80) |>  clipr::write_clip()
broom::glance(table3)
broom::glance(temp3)
broom::glance(summary(temp3))
broom::tidy(temp3)
broom::tidy(tibble::as.tibble( temp3))
broom::tidy(tibble::as_tibble( temp3))
stargazer::stargazer(temp3)
install.packages("Hmisc")
Hmisc::describe(temp3)
Hmisc::describe(temp3) |> clipr::write_clip()
Hmisc::describe(temp3) |> capture.output() |> clipr::write_clip()
summary(temp3) |> capture.output() |> clipr::write_clip()
ncei_url
ncei_url <- httr::modify_url(
url = "https://www.ncei.noaa.gov",
path = "data/global-hourly/access/2024/87576099999.csv")
ncei_url
model <- plm(T.max ~ LTM_year_last, data=temp3, index = "LTM_yday_last")
summary(model)
capture.output(summary(model)) |> clipr::write_clip()
model <- plm(T.med ~ LTM_year_last, data=temp3, index = "LTM_yday_last")
capture.output(summary(model)) |> clipr::write_clip()
.95 * 365
.05 * 365
temp3[by=LTM_year_last, , .N]
temp3[by=LTM_year_last, LTM_year_last >= -18] |> melt(, patterns("^T\\."))
temp3[LTM_year_last >= -18] |> melt(, patterns("^T\\.")) |>
ggplot(aes(variable, group = LTM_year_last)) + geom_boxplot() +
facet_wrap(vars(variable))
temp3[LTM_year_last >= -18] |> melt(, patterns("^T\\.")) |>
ggplot(aes(y= variable, group = LTM_year_last)) + geom_boxplot() +
facet_wrap(vars(variable))
temp3[LTM_year_last >= -18] |> melt(, patterns("^T\\.")) |>
ggplot(aes(y= variable, group = LTM_year_last)) + geom_boxplot() +
facet_wrap(vars(variable), scales = "free")
temp3[LTM_year_last >= -18] |> melt(, patterns("^T\\.")) |>
ggplot(aes(y= variable, x = LTM_year_last)) + geom_boxplot() +
facet_wrap(vars(variable), scales = "free")
temp3[LTM_year_last >= -18] |> melt(, patterns("^T\\.")) |>
ggplot(aes(y= variable, x = factor(LTM_year_last))) + geom_boxplot() +
facet_wrap(vars(variable), scales = "free")
temp3[LTM_year_last >= -18] |> melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = factor(LTM_year_last))) + geom_boxplot() +
facet_wrap(vars(variable), scales = "free")
temp3[LTM_year_last >= -18] |> melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = factor(LTM_year_last))) + geom_boxplot() +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[LTM_year_last >= -18] |> melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = paste0("y", LTM_year_last))) + geom_boxplot() +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[LTM_year_last >= -18] |> melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = factor(paste0("y", LTM_year_last)))) + geom_boxplot() +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[LTM_year_last >= -18] |> melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = factor(LTM_year_last, labels = paste0("y", LTM_year_last)))) + geom_boxplot() +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[LTM_year_last >= -18] |> melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = factor(LTM_year_last, labels = unique(paste0("y", LTM_year_last))))) + geom_boxplot() +
facet_wrap(vars(variable), scales = "free", ncol = 1)
factor(c(2,3,1))
factor(c(2,3,1), levels = c(2,3,1))
factor(c(2,3,1))
ordered(c(2,3,1))
as.factor(c(2,3,1))
factor(c(2,3,1))
factor(c(2,3,1), ordered = T)
factor(c(2,3,1), levels = c(2,3,1))
factor(c(2,3,1,3), levels = c(2,3,1,3))
factor(c(2,3,1,3), levels = c(2,3,1))
temp3[LTM_year_last >= -18, c(
.SD, `Años desde el presente` = factor(LTM_year_last, paste0("y", -18:-0)))] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[LTM_year_last >= -18, c(
.SD, `Años desde el presente` = factor(LTM_year_last, paste0("y", -18:-0)))]
temp3[LTM_year_last >= -18,
`Años desde el presente` := factor(LTM_year_last, paste0("y", -18:-0))] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
facet_wrap(vars(variable), scales = "free", ncol = 1)
View(temp3)
temp3[LTM_year_last >= -18,`Años desde el presente` := factor(
paste("y", LTM_year_last), paste0("y", -18:-0))] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
facet_wrap(vars(variable), scales = "free", ncol = 1)
View(temp3)
temp3[LTM_year_last >= -18,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(label = "value", stat = "mean")+
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(label = "value", stat = mean)+
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3_mean <- temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
_[,by = .(variable, LTM_year_last, `Años desde el presente`),.(value = mean(value))]
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(label = "value", data = temp3_mean)+
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(label = value, data = temp3_mean)+
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(label = values, data = temp3_mean)+
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(aes(label = value), data = temp3_mean) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(aes(label = value), inherit.aes = T, data = temp3_mean) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
facet_wrap(vars(variable), scales = "free", ncol = 1) +
geom_text(aes(label = value), inherit.aes = T, data = temp3_mean) +
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
facet_wrap(vars(variable), scales = "free", ncol = 1) +
geom_text(aes(label = value), inherit.aes = T, data = temp3_mean)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
facet_wrap(vars(variable), scales = "free", ncol = 1) +
geom_text(aes(label = value), inherit.aes = F, data = temp3_mean)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(aes(label = value, x = `Años desde el presente`),  data = temp3_mean) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(aes(label = sprintf("%02.1d",value), x = `Años desde el presente`),  data = temp3_mean) +
facet_wrap(vars(variable), scales = "free", ncol = 1) +
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(aes(label = sprintf("%02.1d",value), x = `Años desde el presente`),  data = temp3_mean) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(aes(label = sprintf("%02.1f",value), x = `Años desde el presente`),  data = temp3_mean) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(aes(label = sprintf("%02.1f",value), x = `Años desde el presente`, vjust = 1),  data = temp3_mean) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(
aes(label = sprintf("%02.1f",value), x = `Años desde el presente`),
vjust = 1, size = 5,  data = temp3_mean) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(
aes(label = sprintf("%02.1f",value), x = `Años desde el presente`),
vjust = -1, size = 2,  data = temp3_mean) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(
aes(label = sprintf("%02.1f",value), x = `Años desde el presente`),
vjust = -1, size = 3,  data = temp3_mean) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(
aes(label = sprintf("%02.1f",value), x = `Años desde el presente`),
vjust = -0.8, size = 3,  data = temp3_mean) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(
aes(label = sprintf("%02.1f",value), x = `Años desde el presente`),
vjust = -0.5, size = 3,  data = temp3_mean) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(
aes(label = sprintf("%02.1f",value), x = `Años desde el presente`),
nudge_y = 0.5, size = 3,  data = temp3_mean) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(
aes(label = sprintf("%02.1f",value), x = `Años desde el presente`),
nudge_y = 1.5, size = 3,  data = temp3_mean) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3_median <- temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
_[,by = .(variable, LTM_year_last, `Años desde el presente`),.(value = median(value))]
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(
aes(label = sprintf("%02.1f",value), x = `Años desde el presente`),
size = 3, nudge_y = 1,  data = temp3_median) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(
aes(label = sprintf("%02.1f",value), x = `Años desde el presente`),
size = 3, nudge_y = 1.2,  data = temp3_median) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(
aes(label = sprintf("%02.1f",value), x = `Años desde el presente`),
size = 3, nudge_y = 1.3,  data = temp3_median) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
temp3[,`Años desde el presente` := factor(
paste0("y", LTM_year_last), paste0("y", -18:-0))][LTM_year_last >= -18] |>
melt(, patterns("^T\\.")) |>
ggplot(aes(y= value, x = `Años desde el presente`))  + geom_boxplot() +
geom_text(
aes(label = sprintf("%02.1f",value), x = `Años desde el presente`),
size = 3, nudge_y = 1.5,  data = temp3_median) +
facet_wrap(vars(variable), scales = "free", ncol = 1)
max(temp3$FECHA)
nchar(c("a", NA))
which(nchar(c("a", NA))>0)
setwd("~\\R\\translations\\data.table\\vignettes\\es")
rmd_files  <- dir(pattern=".Rmd$")
lapply(rmd_files, markdown::render)
lapply(rmd_files, markdown::mark)
setwd("~\\R\\translations\\data.table\\vignettes")
rmd_files  <- dir(pattern=".Rmd$")
lapply(rmd_files, markdown::render, rmarkdown::html_vignette())
lapply(rmd_files, rmarkdown::render, rmarkdown::html_vignette())
library(data.table)
lapply(rmd_files, rmarkdown::render, rmarkdown::html_vignette())
.datatable.aware = T
lapply(rmd_files, rmarkdown::render, rmarkdown::html_vignette())
setwd("~\\R\\translations\\data.table\\vignettes")
rmd_files  <- dir(pattern=".Rmd$")
rmd_files
lapply(rmd_files, rmarkdown::render, rmarkdown::html_vignette())
setwd("~\\R\\translations\\data.table\\vignettes")
rmd_files  <- dir(pattern=".Rmd$")
lapply(rmd_files, rmarkdown::render, rmarkdown::html_vignette())
library(data.table)
lapply(rmd_files, rmarkdown::render, rmarkdown::html_vignette())
data.table(a=1)[,b:=2]
person("Ric")
unclass(person("Ric"))
