<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2024-09-21" />

<title>Efficient reshaping using data.tables</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Efficient reshaping using data.tables</h1>
<h4 class="date">2024-09-21</h4>



<p>Esta viñeta analiza el uso predeterminado de las funciones de
remodelación <code>melt</code> (de ancho a largo) y <code>dcast</code>
(de largo a ancho) para <em>data.tables</em>, así como las
<strong>nuevas funcionalidades extendidas</strong> de fusión y
conversión en <em>múltiples columnas</em> disponibles a partir de
<code>v1.9.6</code>. (N. de T.: los nombres <code>melt</code> y
<code>dcast</code> vienen del paquete <em>reshape2</em>, y fueron
tomados de la idea de la fundición de metales, donde el metal se
<em>funde</em> —<em>melt</em>ing— y luego se vuelca en un molde o se
<em>moldea</em> —<em>cast</em>ing— para darle forma).</p>
<hr />
<div id="datos" class="section level2">
<h2>Datos</h2>
<p>Cargaremos los conjuntos de datos directamente dentro de las
secciones.</p>
</div>
<div id="introducción" class="section level2">
<h2>Introducción</h2>
<p>Las funciones <code>melt</code> y <code>dcast</code> para
<code>data.table</code>s sirven para cambiar la forma de ancho a largo y
de largo a ancho, respectivamente; las implementaciones están diseñadas
específicamente teniendo en mente grandes datos en memoria (por ejemplo,
10 Gb).</p>
<p>En esta viñeta, vamos a</p>
<p>=====1. Primero, observar brevemente la conversión predeterminada de
<code>melt</code> y <code>dcast</code> de <code>data.table</code> para
convertirlas de formato <em>ancho</em> a <em>largo</em> y
<em>viceversa</em>=====</p>
<p>=====2. Analizar los escenarios en los que las funcionalidades
actuales se vuelven engorrosas e ineficientes=====</p>
<p>=====3. Por último, observar las nuevas mejoras en los métodos
<code>melt</code> y <code>dcast</code> para que <code>data.table</code>
pueda manejar múltiples columnas simultáneamente.=====</p>
<p>Las funcionalidades extendidas están en línea con la filosofía de
<code>data.table</code> de realizar operaciones de manera eficiente y
sencilla.</p>
</div>
<div id="funcionalidad-predeterminada" class="section level2">
<h2>1. Funcionalidad predeterminada</h2>
<div id="a-melt-transformar-una-data.table-de-ancho-a-largo" class="section level3">
<h3>a) <code>melt</code>: transformar una <code>data.table</code> de
ancho a largo</h3>
<p>Supongamos que tenemos una <code>data.table</code> (datos
artificiales) como se muestra a continuación:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="st">&quot;family_id age_mother dob_child1 dob_child2 dob_child3</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="st">1         30 1998-11-26 2000-01-29         NA</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="st">2         27 1996-06-22         NA         NA</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="st">3         26 2002-07-11 2004-04-05 2007-09-02</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="st">4         32 2004-10-10 2009-08-27 2012-07-21</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="st">5         29 2000-12-05 2005-02-28         NA&quot;</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>DT <span class="ot">&lt;-</span> <span class="fu">fread</span>(s1)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>DT</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#    family_id age_mother dob_child1 dob_child2 dob_child3</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#        &lt;int&gt;      &lt;int&gt;     &lt;IDat&gt;     &lt;IDat&gt;     &lt;IDat&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co"># 1:         1         30 1998-11-26 2000-01-29       &lt;NA&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co"># 2:         2         27 1996-06-22       &lt;NA&gt;       &lt;NA&gt;</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co"># 3:         3         26 2002-07-11 2004-04-05 2007-09-02</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co"># 4:         4         32 2004-10-10 2009-08-27 2012-07-21</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co"># 5:         5         29 2000-12-05 2005-02-28       &lt;NA&gt;</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="do">## dob stands for date of birth.</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="fu">str</span>(DT)</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="co"># Classes &#39;data.table&#39; and &#39;data.frame&#39;:    5 obs. of  5 variables:</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co">#  $ family_id : int  1 2 3 4 5</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="co">#  $ age_mother: int  30 27 26 32 29</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="co">#  $ dob_child1: IDate, format: &quot;1998-11-26&quot; &quot;1996-06-22&quot; &quot;2002-07-11&quot; ...</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="co">#  $ dob_child2: IDate, format: &quot;2000-01-29&quot; NA &quot;2004-04-05&quot; ...</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="co">#  $ dob_child3: IDate, format: NA NA &quot;2007-09-02&quot; ...</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="co">#  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</span></span></code></pre></div>
<div id="convertir-dt-a-formato-largo-donde-cada-dob-es-una-observación-separada." class="section level4">
<h4>- Convertir ‘DT’ a formato <em>largo</em> donde cada ‘dob’ es una
observación separada.</h4>
<p>Podríamos lograr esto usando <code>melt()</code> especificando los
argumentos <code>id.vars</code> y <code>measure.vars</code> de la
siguiente manera:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>DT.m1 <span class="ot">=</span> <span class="fu">melt</span>(DT, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;family_id&quot;</span>, <span class="st">&quot;age_mother&quot;</span>),</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>                <span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">&quot;dob_child1&quot;</span>, <span class="st">&quot;dob_child2&quot;</span>, <span class="st">&quot;dob_child3&quot;</span>))</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>DT.m1</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#     family_id age_mother   variable      value</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#         &lt;int&gt;      &lt;int&gt;     &lt;fctr&gt;     &lt;IDat&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#  1:         1         30 dob_child1 1998-11-26</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#  2:         2         27 dob_child1 1996-06-22</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#  3:         3         26 dob_child1 2002-07-11</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#  4:         4         32 dob_child1 2004-10-10</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#  5:         5         29 dob_child1 2000-12-05</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#  6:         1         30 dob_child2 2000-01-29</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#  7:         2         27 dob_child2       &lt;NA&gt;</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#  8:         3         26 dob_child2 2004-04-05</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#  9:         4         32 dob_child2 2009-08-27</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co"># 10:         5         29 dob_child2 2005-02-28</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co"># 11:         1         30 dob_child3       &lt;NA&gt;</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co"># 12:         2         27 dob_child3       &lt;NA&gt;</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co"># 13:         3         26 dob_child3 2007-09-02</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co"># 14:         4         32 dob_child3 2012-07-21</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co"># 15:         5         29 dob_child3       &lt;NA&gt;</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="fu">str</span>(DT.m1)</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co"># Classes &#39;data.table&#39; and &#39;data.frame&#39;:    15 obs. of  4 variables:</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="co">#  $ family_id : int  1 2 3 4 5 1 2 3 4 5 ...</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="co">#  $ age_mother: int  30 27 26 32 29 30 27 26 32 29 ...</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="co">#  $ variable  : Factor w/ 3 levels &quot;dob_child1&quot;,&quot;dob_child2&quot;,..: 1 1 1 1 1 2 2 2 2 2 ...</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="co">#  $ value     : IDate, format: &quot;1998-11-26&quot; &quot;1996-06-22&quot; &quot;2002-07-11&quot; ...</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co">#  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</span></span></code></pre></div>
<p>=====* <code>measure.vars</code> especifica el conjunto de columnas
que nos gustaría contraer (o combinar) juntas.=====</p>
<p>=====* También podemos especificar <em>números</em> de columna en
lugar de <em>nombres</em>.=====</p>
<p>=====* De manera predeterminada, la columna <code>variable</code> es
del tipo <code>factor</code>. Establezca el argumento
<code>variable.factor</code> en <code>FALSE</code> si desea devolver un
vector <code>character</code> en su lugar.=====</p>
<p>=====* De manera predeterminada, las columnas fundidas se denominan
automáticamente <code>variable</code> y <code>value</code>.=====</p>
<ul>
<li><code>melt</code> conserva los atributos de la columna en el
resultado.</li>
</ul>
</div>
<div id="nombrar-las-columnas-variable-y-value-como-child-y-dob-respectivamente" class="section level4">
<h4>- Nombrar las columnas <code>variable</code> y <code>value</code>
como <code>child</code> y <code>dob</code> respectivamente</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>DT.m1 <span class="ot">=</span> <span class="fu">melt</span>(DT, <span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">&quot;dob_child1&quot;</span>, <span class="st">&quot;dob_child2&quot;</span>, <span class="st">&quot;dob_child3&quot;</span>),</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>               <span class="at">variable.name =</span> <span class="st">&quot;child&quot;</span>, <span class="at">value.name =</span> <span class="st">&quot;dob&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>DT.m1</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#     family_id age_mother      child        dob</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#         &lt;int&gt;      &lt;int&gt;     &lt;fctr&gt;     &lt;IDat&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#  1:         1         30 dob_child1 1998-11-26</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#  2:         2         27 dob_child1 1996-06-22</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#  3:         3         26 dob_child1 2002-07-11</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#  4:         4         32 dob_child1 2004-10-10</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#  5:         5         29 dob_child1 2000-12-05</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#  6:         1         30 dob_child2 2000-01-29</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#  7:         2         27 dob_child2       &lt;NA&gt;</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#  8:         3         26 dob_child2 2004-04-05</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#  9:         4         32 dob_child2 2009-08-27</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co"># 10:         5         29 dob_child2 2005-02-28</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co"># 11:         1         30 dob_child3       &lt;NA&gt;</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co"># 12:         2         27 dob_child3       &lt;NA&gt;</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co"># 13:         3         26 dob_child3 2007-09-02</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co"># 14:         4         32 dob_child3 2012-07-21</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co"># 15:         5         29 dob_child3       &lt;NA&gt;</span></span></code></pre></div>
<p>=====* De manera predeterminada, cuando falta una de las
<code>id.vars</code> o <code>measure.vars</code>, el resto de las
columnas se <em>asignan automáticamente</em> al argumento
faltante.=====</p>
<p>=====* Cuando no se especifican ni <code>id.vars</code> ni
<code>measure.vars</code>, como se menciona en <code>?melt</code>, todas
las columnas <em>no</em> <code>numeric</code>, <code>integer</code> y
<code>logical</code> se asignarán a <code>id.vars</code>.=====</p>
<pre><code>In addition, a warning message is issued highlighting the columns that are automatically considered to be `id.vars`.</code></pre>
</div>
</div>
<div id="b-dcast-transformar-una-data.table-de-largo-a-ancho" class="section level3">
<h3>b) <code>dcast</code>: transformar una <code>data.table</code> de
largo a ancho</h3>
<p>En la sección anterior, vimos cómo pasar del formato ancho al formato
largo. Veamos la operación inversa en esta sección.</p>
<div id="cómo-podemos-volver-a-la-tabla-de-datos-original-dt-desde-dt.m1" class="section level4">
<h4>- ¿Cómo podemos volver a la tabla de datos original <code>DT</code>
desde <code>DT.m1</code>?</h4>
<p>Es decir, nos gustaría recopilar todas las observaciones de
<em>child</em> correspondientes a cada
<code>family_id, age_mother</code> juntas en la misma fila. Podemos
lograrlo usando <code>dcast</code> de la siguiente manera:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">dcast</span>(DT.m1, family_id <span class="sc">+</span> age_mother <span class="sc">~</span> child, <span class="at">value.var =</span> <span class="st">&quot;dob&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co"># Key: &lt;family_id, age_mother&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#    family_id age_mother dob_child1 dob_child2 dob_child3</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#        &lt;int&gt;      &lt;int&gt;     &lt;IDat&gt;     &lt;IDat&gt;     &lt;IDat&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co"># 1:         1         30 1998-11-26 2000-01-29       &lt;NA&gt;</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co"># 2:         2         27 1996-06-22       &lt;NA&gt;       &lt;NA&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co"># 3:         3         26 2002-07-11 2004-04-05 2007-09-02</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co"># 4:         4         32 2004-10-10 2009-08-27 2012-07-21</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co"># 5:         5         29 2000-12-05 2005-02-28       &lt;NA&gt;</span></span></code></pre></div>
<p>=====* <code>dcast</code> utiliza la interfaz <em>formula</em>. Las
variables del <em>lado izquierdo</em> de la fórmula representan las
variables <em>id</em> y del <em>lado derecho</em> las variables
<em>measure</em>.=====</p>
<p>=====* <code>value.var</code> indica la columna que se debe completar
al convertir a formato ancho.=====</p>
<p>=====* <code>dcast</code> también intenta preservar los atributos en
el resultado siempre que sea posible.=====</p>
</div>
<div id="a-partir-de-dt.m1-cómo-podemos-obtener-el-número-de-hijos-en-cada-familia" class="section level4">
<h4>- A partir de <code>DT.m1</code>, ¿cómo podemos obtener el número de
hijos en cada familia?</h4>
<p>También puede pasar una función para agregar en <code>dcast</code>
con el argumento <code>fun.agregate</code>. Esto es particularmente
esencial cuando la fórmula proporcionada no identifica una sola
observación para cada celda.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">dcast</span>(DT.m1, family_id <span class="sc">~</span> ., <span class="at">fun.agg =</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(x)), <span class="at">value.var =</span> <span class="st">&quot;dob&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co"># Key: &lt;family_id&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#    family_id     .</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#        &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co"># 1:         1     2</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co"># 2:         2     1</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co"># 3:         3     3</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co"># 4:         4     3</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co"># 5:         5     2</span></span></code></pre></div>
<p>Consulte <code>?dcast</code> para obtener otros argumentos útiles y
ejemplos adicionales.</p>
</div>
</div>
</div>
<div id="limitaciones-de-los-métodos-actuales-de-meltdcast" class="section level2">
<h2>2. Limitaciones de los métodos actuales de
<code>melt/dcast</code></h2>
<p>Hasta ahora hemos visto características de <code>melt</code> y
<code>dcast</code> que se implementan de manera eficiente para
<code>data.table</code>s, utilizando la maquinaria interna de
<code>data.table</code> (<em>ordenamiento rápido de radix</em>,
<em>búsqueda binaria</em>, etc.).</p>
<p>Sin embargo, existen situaciones en las que podemos encontrarnos con
la operación deseada que no se expresa de manera sencilla. Por ejemplo,
considere la <code>data.table</code> que se muestra a continuación:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> <span class="st">&quot;family_id age_mother dob_child1 dob_child2 dob_child3 gender_child1 gender_child2 gender_child3</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="st">1         30 1998-11-26 2000-01-29         NA             1             2            NA</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="st">2         27 1996-06-22         NA         NA             2            NA            NA</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="st">3         26 2002-07-11 2004-04-05 2007-09-02             2             2             1</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="st">4         32 2004-10-10 2009-08-27 2012-07-21             1             1             1</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="st">5         29 2000-12-05 2005-02-28         NA             2             1            NA&quot;</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>DT <span class="ot">&lt;-</span> <span class="fu">fread</span>(s2)</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>DT</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#    family_id age_mother dob_child1 dob_child2 dob_child3 gender_child1 gender_child2 gender_child3</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#        &lt;int&gt;      &lt;int&gt;     &lt;IDat&gt;     &lt;IDat&gt;     &lt;IDat&gt;         &lt;int&gt;         &lt;int&gt;         &lt;int&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co"># 1:         1         30 1998-11-26 2000-01-29       &lt;NA&gt;             1             2            NA</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co"># 2:         2         27 1996-06-22       &lt;NA&gt;       &lt;NA&gt;             2            NA            NA</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co"># 3:         3         26 2002-07-11 2004-04-05 2007-09-02             2             2             1</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co"># 4:         4         32 2004-10-10 2009-08-27 2012-07-21             1             1             1</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co"># 5:         5         29 2000-12-05 2005-02-28       &lt;NA&gt;             2             1            NA</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="do">## 1 = female, 2 = male</span></span></code></pre></div>
<p>Y desea combinar (<code>melt</code>) todas las columnas
<code>dob</code> y <code>gender</code>. Con la funcionalidad actual,
podemos hacer algo como esto:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>DT.m1 <span class="ot">=</span> <span class="fu">melt</span>(DT, <span class="at">id =</span> <span class="fu">c</span>(<span class="st">&quot;family_id&quot;</span>, <span class="st">&quot;age_mother&quot;</span>))</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>DT.m1[, <span class="fu">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;child&quot;</span>) <span class="sc">:=</span> <span class="fu">tstrsplit</span>(variable, <span class="st">&quot;_&quot;</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>DT.c1 <span class="ot">=</span> <span class="fu">dcast</span>(DT.m1, family_id <span class="sc">+</span> age_mother <span class="sc">+</span> child <span class="sc">~</span> variable, <span class="at">value.var =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>DT.c1</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co"># Key: &lt;family_id, age_mother, child&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#     family_id age_mother  child        dob     gender</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#         &lt;int&gt;      &lt;int&gt; &lt;char&gt;     &lt;IDat&gt;     &lt;IDat&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#  1:         1         30 child1 1998-11-26 1970-01-02</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#  2:         1         30 child2 2000-01-29 1970-01-03</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#  3:         1         30 child3       &lt;NA&gt;       &lt;NA&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#  4:         2         27 child1 1996-06-22 1970-01-03</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#  5:         2         27 child2       &lt;NA&gt;       &lt;NA&gt;</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#  6:         2         27 child3       &lt;NA&gt;       &lt;NA&gt;</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#  7:         3         26 child1 2002-07-11 1970-01-03</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#  8:         3         26 child2 2004-04-05 1970-01-03</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#  9:         3         26 child3 2007-09-02 1970-01-02</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co"># 10:         4         32 child1 2004-10-10 1970-01-02</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co"># 11:         4         32 child2 2009-08-27 1970-01-02</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co"># 12:         4         32 child3 2012-07-21 1970-01-02</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="co"># 13:         5         29 child1 2000-12-05 1970-01-03</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="co"># 14:         5         29 child2 2005-02-28 1970-01-02</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="co"># 15:         5         29 child3       &lt;NA&gt;       &lt;NA&gt;</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="fu">str</span>(DT.c1) <span class="do">## gender column is character type now!</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a><span class="co"># Classes &#39;data.table&#39; and &#39;data.frame&#39;:    15 obs. of  5 variables:</span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="co">#  $ family_id : int  1 1 1 2 2 2 3 3 3 4 ...</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="co">#  $ age_mother: int  30 30 30 27 27 27 26 26 26 32 ...</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="co">#  $ child     : chr  &quot;child1&quot; &quot;child2&quot; &quot;child3&quot; &quot;child1&quot; ...</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a><span class="co">#  $ dob       : IDate, format: &quot;1998-11-26&quot; &quot;2000-01-29&quot; NA ...</span></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a><span class="co">#  $ gender    : IDate, format: &quot;1970-01-02&quot; &quot;1970-01-03&quot; NA ...</span></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a><span class="co">#  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt; </span></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a><span class="co">#  - attr(*, &quot;sorted&quot;)= chr [1:3] &quot;family_id&quot; &quot;age_mother&quot; &quot;child&quot;</span></span></code></pre></div>
<div id="inconvenientes" class="section level4">
<h4>Inconvenientes</h4>
<p>=====1. Lo que queríamos hacer era combinar todas las columnas de
tipo <code>dob</code> y <code>gender</code> respectivamente. En lugar de
eso, estamos combinando <em>todo</em> y luego dividiendo todo. Creo que
es fácil ver que es bastante indirecto (e ineficiente).=====</p>
<pre><code>As an analogy, imagine you&#39;ve a closet with four shelves of clothes and you&#39;d like to put together the clothes from shelves 1 and 2 together (in 1), and 3 and 4 together (in 3). What we are doing is more or less to combine all the clothes together, and then split them back on to shelves 1 and 3!</code></pre>
<p>=====2. Las columnas que se van a <code>melt</code> pueden ser de
tipos diferentes, como en este caso (tipos <code>character</code> y
<code>integer</code>). Al fundirlas todas juntas, las columnas se
convertirán en el resultado (al tipo de datos más flexible), como se
explica en el mensaje de advertencia anterior y se muestra en la salida
de <code>str(DT.c1)</code>, donde <code>gender</code> se ha convertido
al tipo <em><code>character</code></em>.=====</p>
<p>=====3. Estamos generando una columna adicional dividiendo la columna
<code>variable</code> en dos columnas, cuyo propósito es bastante
críptico. Lo hacemos porque lo necesitamos para la <em>conversión</em>
en el siguiente paso.=====</p>
<p>=====4. Finalmente, convertimos el conjunto de datos. Pero el
problema es que es una operación que requiere mucho más trabajo
computacional que <em>melt</em>. En concreto, requiere calcular el orden
de las variables en la fórmula, y eso es costoso.=====</p>
<p>De hecho, <code>stats::reshape</code> es capaz de realizar esta
operación de una manera muy sencilla. Es una función extremadamente útil
y a menudo subestimada. ¡Definitivamente debería probarla!</p>
</div>
</div>
<div id="funcionalidad-mejorada-nueva" class="section level2">
<h2>3. Funcionalidad mejorada (nueva)</h2>
<div id="a-fusión-mejorada" class="section level3">
<h3>a) Fusión mejorada</h3>
<p>Como nos gustaría que <code>data.table</code> realice esta operación
de manera sencilla y eficiente utilizando la misma interfaz, seguimos
adelante e implementamos una <em>funcionalidad adicional</em>, donde
podemos <code>fusionar</code> varias columnas
<em>simultáneamente</em>.</p>
<div id="fundir-melt-múltiples-columnas-simultáneamente" class="section level4">
<h4>- *fundir (<code>melt</code>) múltiples columnas
simultáneamente</h4>
<p>La idea es bastante sencilla. Pasamos una lista de columnas a
<code>measure.vars</code>, donde cada elemento de la lista contiene las
columnas que deben combinarse.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>colA <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&quot;dob_child&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>colB <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&quot;gender_child&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>DT.m2 <span class="ot">=</span> <span class="fu">melt</span>(DT, <span class="at">measure =</span> <span class="fu">list</span>(colA, colB), <span class="at">value.name =</span> <span class="fu">c</span>(<span class="st">&quot;dob&quot;</span>, <span class="st">&quot;gender&quot;</span>))</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>DT.m2</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#     family_id age_mother variable        dob gender</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#         &lt;int&gt;      &lt;int&gt;   &lt;fctr&gt;     &lt;IDat&gt;  &lt;int&gt;</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#  1:         1         30        1 1998-11-26      1</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#  2:         2         27        1 1996-06-22      2</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#  3:         3         26        1 2002-07-11      2</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#  4:         4         32        1 2004-10-10      1</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#  5:         5         29        1 2000-12-05      2</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#  6:         1         30        2 2000-01-29      2</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#  7:         2         27        2       &lt;NA&gt;     NA</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#  8:         3         26        2 2004-04-05      2</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#  9:         4         32        2 2009-08-27      1</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co"># 10:         5         29        2 2005-02-28      1</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co"># 11:         1         30        3       &lt;NA&gt;     NA</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co"># 12:         2         27        3       &lt;NA&gt;     NA</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co"># 13:         3         26        3 2007-09-02      1</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co"># 14:         4         32        3 2012-07-21      1</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="co"># 15:         5         29        3       &lt;NA&gt;     NA</span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a><span class="fu">str</span>(DT.m2) <span class="do">## col type is preserved</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a><span class="co"># Classes &#39;data.table&#39; and &#39;data.frame&#39;:    15 obs. of  5 variables:</span></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a><span class="co">#  $ family_id : int  1 2 3 4 5 1 2 3 4 5 ...</span></span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a><span class="co">#  $ age_mother: int  30 27 26 32 29 30 27 26 32 29 ...</span></span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a><span class="co">#  $ variable  : Factor w/ 3 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;: 1 1 1 1 1 2 2 2 2 2 ...</span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a><span class="co">#  $ dob       : IDate, format: &quot;1998-11-26&quot; &quot;1996-06-22&quot; &quot;2002-07-11&quot; ...</span></span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a><span class="co">#  $ gender    : int  1 2 2 1 2 2 NA 2 1 1 ...</span></span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a><span class="co">#  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</span></span></code></pre></div>
<p>*Podemos eliminar la columna <code>variable</code> si es
necesario.</p>
<p>=====* La funcionalidad está implementada completamente en C y, por
lo tanto, es <em>rápida</em> y <em>eficiente en el uso de la
memoria</em>, además de ser <em>sencilla</em>.=====</p>
</div>
<div id="usar-patterns" class="section level4">
<h4>- Usar <code>patterns()</code></h4>
<p>Por lo general, en estos problemas, las columnas que queremos fundir
se pueden distinguir por un patrón común. Podemos utilizar la función
<code>patterns()</code>, implementada por conveniencia, para
proporcionar expresiones regulares para las columnas que se combinarán.
La operación anterior se puede reescribir como:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>DT.m2 <span class="ot">=</span> <span class="fu">melt</span>(DT, <span class="at">measure =</span> <span class="fu">patterns</span>(<span class="st">&quot;^dob&quot;</span>, <span class="st">&quot;^gender&quot;</span>), <span class="at">value.name =</span> <span class="fu">c</span>(<span class="st">&quot;dob&quot;</span>, <span class="st">&quot;gender&quot;</span>))</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>DT.m2</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#     family_id age_mother variable        dob gender</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#         &lt;int&gt;      &lt;int&gt;   &lt;fctr&gt;     &lt;IDat&gt;  &lt;int&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#  1:         1         30        1 1998-11-26      1</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#  2:         2         27        1 1996-06-22      2</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#  3:         3         26        1 2002-07-11      2</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#  4:         4         32        1 2004-10-10      1</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#  5:         5         29        1 2000-12-05      2</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#  6:         1         30        2 2000-01-29      2</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#  7:         2         27        2       &lt;NA&gt;     NA</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#  8:         3         26        2 2004-04-05      2</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#  9:         4         32        2 2009-08-27      1</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co"># 10:         5         29        2 2005-02-28      1</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co"># 11:         1         30        3       &lt;NA&gt;     NA</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co"># 12:         2         27        3       &lt;NA&gt;     NA</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co"># 13:         3         26        3 2007-09-02      1</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co"># 14:         4         32        3 2012-07-21      1</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co"># 15:         5         29        3       &lt;NA&gt;     NA</span></span></code></pre></div>
</div>
<div id="usar-measure-para-especificar-measure.vars-a-través-de-un-separador-o-patrón" class="section level4">
<h4>- Usar <code>measure()</code> para especificar
<code>measure.vars</code> a través de un separador o patrón</h4>
<p>Si, como en los datos anteriores, las columnas de entrada que se van
a fundir tienen nombres regulares, entonces podemos usar
<code>measure</code>, que permite especificar las columnas que se van a
fundir mediante un separador o una expresión regular. Por ejemplo,
considere los datos de <code>iris</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>(<span class="at">two.iris =</span> <span class="fu">data.table</span>(datasets<span class="sc">::</span>iris)[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">150</span>)])</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#    Sepal.Length Sepal.Width Petal.Length Petal.Width   Species</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#           &lt;num&gt;       &lt;num&gt;        &lt;num&gt;       &lt;num&gt;    &lt;fctr&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co"># 1:          5.1         3.5          1.4         0.2    setosa</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co"># 2:          5.9         3.0          5.1         1.8 virginica</span></span></code></pre></div>
<p>Los datos de <code>iris</code> tienen cuatro columnas numéricas con
una estructura regular: primero la parte de la flor, luego un punto y
luego la dimensión de la medida. Para especificar que queremos fusionar
esas cuatro columnas, podemos usar <code>measure</code> con
<code>sep=&quot;.&quot;</code>, lo que significa usar <code>strsplit</code> en
todos los nombres de columna; las columnas que resulten en la cantidad
máxima de grupos después de la división se usarán como
<code>measure.vars</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">melt</span>(two.iris, <span class="at">measure.vars =</span> <span class="fu">measure</span>(part, dim, <span class="at">sep=</span><span class="st">&quot;.&quot;</span>))</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#      Species   part    dim value</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#       &lt;fctr&gt; &lt;char&gt; &lt;char&gt; &lt;num&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co"># 1:    setosa  Sepal Length   5.1</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co"># 2: virginica  Sepal Length   5.9</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co"># 3:    setosa  Sepal  Width   3.5</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co"># 4: virginica  Sepal  Width   3.0</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co"># 5:    setosa  Petal Length   1.4</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co"># 6: virginica  Petal Length   5.1</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co"># 7:    setosa  Petal  Width   0.2</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co"># 8: virginica  Petal  Width   1.8</span></span></code></pre></div>
<p>Los primeros dos argumentos de <code>measure</code> en el código
anterior (<code>part</code> y <code>dim</code>) se utilizan para nombrar
las columnas de salida; la cantidad de argumentos debe ser igual a la
cantidad máxima de grupos después de dividir con <code>sep</code>.</p>
<p>Si queremos dos columnas de valores, una para cada parte, podemos
usar la palabra clave especial <code>value.name</code>, lo que significa
generar una columna de valores para cada nombre único encontrado en ese
grupo:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">melt</span>(two.iris, <span class="at">measure.vars =</span> <span class="fu">measure</span>(value.name, dim, <span class="at">sep=</span><span class="st">&quot;.&quot;</span>))</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#      Species    dim Sepal Petal</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#       &lt;fctr&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co"># 1:    setosa Length   5.1   1.4</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co"># 2: virginica Length   5.9   5.1</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co"># 3:    setosa  Width   3.5   0.2</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co"># 4: virginica  Width   3.0   1.8</span></span></code></pre></div>
<p>Usando el código anterior obtenemos una columna de valor por cada
parte de la flor. Si en cambio queremos una columna de valor para cada
dimensión de medida, podemos hacer</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">melt</span>(two.iris, <span class="at">measure.vars =</span> <span class="fu">measure</span>(part, value.name, <span class="at">sep=</span><span class="st">&quot;.&quot;</span>))</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#      Species   part Length Width</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#       &lt;fctr&gt; &lt;char&gt;  &lt;num&gt; &lt;num&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co"># 1:    setosa  Sepal    5.1   3.5</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co"># 2: virginica  Sepal    5.9   3.0</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co"># 3:    setosa  Petal    1.4   0.2</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co"># 4: virginica  Petal    5.1   1.8</span></span></code></pre></div>
<p>Volviendo al ejemplo de los datos con familias e hijos, podemos ver
un uso más complejo de <code>measure</code>, que involucra una función
que se utiliza para convertir los valores de la cadena
<code>child</code> en números enteros:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>DT.m3 <span class="ot">=</span> <span class="fu">melt</span>(DT, <span class="at">measure =</span> <span class="fu">measure</span>(value.name, <span class="at">child=</span>as.integer, <span class="at">sep=</span><span class="st">&quot;_child&quot;</span>))</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>DT.m3</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#     family_id age_mother child        dob gender</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#         &lt;int&gt;      &lt;int&gt; &lt;int&gt;     &lt;IDat&gt;  &lt;int&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#  1:         1         30     1 1998-11-26      1</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#  2:         2         27     1 1996-06-22      2</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#  3:         3         26     1 2002-07-11      2</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#  4:         4         32     1 2004-10-10      1</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#  5:         5         29     1 2000-12-05      2</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#  6:         1         30     2 2000-01-29      2</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#  7:         2         27     2       &lt;NA&gt;     NA</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co">#  8:         3         26     2 2004-04-05      2</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co">#  9:         4         32     2 2009-08-27      1</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co"># 10:         5         29     2 2005-02-28      1</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co"># 11:         1         30     3       &lt;NA&gt;     NA</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co"># 12:         2         27     3       &lt;NA&gt;     NA</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="co"># 13:         3         26     3 2007-09-02      1</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="co"># 14:         4         32     3 2012-07-21      1</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="co"># 15:         5         29     3       &lt;NA&gt;     NA</span></span></code></pre></div>
<p>En el código anterior, usamos <code>sep=&quot;_child&quot;</code>, lo que da
como resultado la fusión de solo las columnas que contienen esa cadena
(seis nombres de columnas divididos en dos grupos cada uno). El
argumento <code>child=as.integer</code> significa que el segundo grupo
dará como resultado una columna de salida llamada <code>child</code> con
valores definidos al insertar las cadenas de caracteres de ese grupo en
la función <code>as.integer</code>.</p>
<p>Finalmente, consideramos un ejemplo (tomado del paquete
<em>tidyr</em>) donde necesitamos definir los grupos usando una
expresión regular en lugar de un separador.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>(who <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">id=</span><span class="dv">1</span>, <span class="at">new_sp_m5564=</span><span class="dv">2</span>, <span class="at">newrel_f65=</span><span class="dv">3</span>))</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co">#       id new_sp_m5564 newrel_f65</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co">#    &lt;num&gt;        &lt;num&gt;      &lt;num&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co"># 1:     1            2          3</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="fu">melt</span>(who, <span class="at">measure.vars =</span> <span class="fu">measure</span>(</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  diagnosis, gender, ages, <span class="at">pattern=</span><span class="st">&quot;new_?(.*)_(.)(.*)&quot;</span>))</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co">#       id diagnosis gender   ages value</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co">#    &lt;num&gt;    &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;num&gt;</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co"># 1:     1        sp      m   5564     2</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co"># 2:     1       rel      f     65     3</span></span></code></pre></div>
<p>Al utilizar el argumento <code>pattern</code>, debe ser una expresión
regular compatible con <em>Perl</em> que contenga la misma cantidad de
grupos de captura (subexpresiones entre paréntesis) que la cantidad de
otros argumentos (nombres de grupos). El código siguiente muestra cómo
utilizar una expresión regular más compleja con cinco grupos, dos
columnas de salida numérica y una función de conversión de tipo
anónima.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">melt</span>(who, <span class="at">measure.vars =</span> <span class="fu">measure</span>(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  diagnosis, gender, ages,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="at">ymin=</span>as.numeric,</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  <span class="at">ymax=</span><span class="cf">function</span>(y) <span class="fu">ifelse</span>(<span class="fu">nzchar</span>(y), <span class="fu">as.numeric</span>(y), <span class="cn">Inf</span>),</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  <span class="at">pattern=</span><span class="st">&quot;new_?(.*)_(.)(([0-9]{2})([0-9]{0,2}))&quot;</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>))</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="co">#       id diagnosis gender   ages  ymin  ymax value</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="co">#    &lt;num&gt;    &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co"># 1:     1        sp      m   5564    55    64     2</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="co"># 2:     1       rel      f     65    65   Inf     3</span></span></code></pre></div>
</div>
</div>
<div id="b-dcast-mejorado" class="section level3">
<h3>b) <code>dcast</code> mejorado</h3>
<p>¡Genial! Ahora podemos fusionar varias columnas simultáneamente.
Ahora, dado el conjunto de datos <code>DT.m2</code> como se muestra
arriba, ¿cómo podemos volver al mismo formato que los datos originales
con los que comenzamos?</p>
<p>Si usamos la funcionalidad actual de <code>dcast</code>, entonces
tendríamos que realizar la conversión dos veces y vincular los
resultados. Pero eso es, una vez más, demasiado aparatoso, no es
sencillo y también es ineficiente.</p>
<div id="conversión-de-múltiples-value.var-simultáneamente" class="section level4">
<h4>- Conversión de múltiples <code>value.var</code>
simultáneamente</h4>
<p>Ahora podemos proporcionar <strong>múltiples columnas
<code>value.var</code></strong> a <code>dcast</code> para
<code>data.table</code> directamente para que las operaciones se
realicen de manera interna y eficiente.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="do">## new &#39;cast&#39; functionality - multiple value.vars</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>DT.c2 <span class="ot">=</span> <span class="fu">dcast</span>(DT.m2, family_id <span class="sc">+</span> age_mother <span class="sc">~</span> variable, <span class="at">value.var =</span> <span class="fu">c</span>(<span class="st">&quot;dob&quot;</span>, <span class="st">&quot;gender&quot;</span>))</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>DT.c2</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co"># Key: &lt;family_id, age_mother&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#    family_id age_mother      dob_1      dob_2      dob_3 gender_1 gender_2 gender_3</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#        &lt;int&gt;      &lt;int&gt;     &lt;IDat&gt;     &lt;IDat&gt;     &lt;IDat&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co"># 1:         1         30 1998-11-26 2000-01-29       &lt;NA&gt;        1        2       NA</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co"># 2:         2         27 1996-06-22       &lt;NA&gt;       &lt;NA&gt;        2       NA       NA</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co"># 3:         3         26 2002-07-11 2004-04-05 2007-09-02        2        2        1</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co"># 4:         4         32 2004-10-10 2009-08-27 2012-07-21        1        1        1</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co"># 5:         5         29 2000-12-05 2005-02-28       &lt;NA&gt;        2        1       NA</span></span></code></pre></div>
<ul>
<li>Los atributos se conservan en el resultado siempre que sea
posible.</li>
</ul>
<p>=====* Todo se gestiona internamente y de manera eficiente. Además de
ser rápido, también es muy eficiente en el uso de la memoria.=====</p>
</div>
</div>
</div>
<div id="section" class="section level1">
<h1></h1>
<div id="varias-funciones-para-fun.agregate" class="section level4">
<h4>Varias funciones para <code>fun.agregate</code>:</h4>
<p>También puede proporcionar <em>múltiples funciones</em> a
<code>fun.agregate</code> para <code>dcast</code> en
<em>data.tables</em>. Consulte los ejemplos en <code>?dcast</code> que
ilustran esta funcionalidad.</p>
</div>
</div>
<div id="section-1" class="section level1">
<h1></h1>
<hr />
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
